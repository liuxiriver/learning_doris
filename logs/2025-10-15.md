# 2025-10-15

## ‰ªäÊó•ÁõÆÊ†á
- Êï¥ÁêÜ‰∏≠ÊñáËá™Â≠¶ÁõÆÂΩï‰∏é‰ªªÂä°Ê∏ÖÂçï„ÄÇ
- Ê†°ÂØπÊú¨Âú∞ÊûÑÂª∫/ÂêØÂä®ÂëΩ‰ª§‰∏éÈ™åËØÅË∑ØÂæÑ„ÄÇ

## Êìç‰ΩúËÆ∞ÂΩï
- Êñ∞Âª∫ learning_doris ÁõÆÂΩï‰∏é‰∏≠ÊñáÊñáÊ°£„ÄÇ
- Ê¢≥ÁêÜ FE/BE ÈòÖËØª‰∏éË∞ÉËØïÂàáÂÖ•Âè£„ÄÇ

## ÂÖ≥ÈîÆÁªìËÆ∫
- Â≠¶‰π†‰∏ªÁ∫øÊåâÔºöÂêØÂä® -> FE -> BE -> Â≠òÂÇ® -> ÊµãËØï/ÁªÉÊâã„ÄÇ
- ‰ª•‰∏ÄÊù° SQL Á´ØÂà∞Á´Ø‰∏∫ÁâµÂºïËøõË°åÊñ≠ÁÇπÈ™åËØÅ„ÄÇ

## ÊòéÊó•ËÆ°Âàí
- ÂêØÂä® FE/BE Âπ∂ÊâßË°åÊúÄÂ∞è SQLÔºåËÆ∞ÂΩï EXPLAIN„ÄÇ
- Âú® FE ÁöÑ Nereids ËßÑÂàô‰∏é planner Â§Ñ‰∏ãÊñ≠ÁÇπ„ÄÇ

## ËÆ°Âàí‰∏éËÆ∞ÂΩï - M1 ÂêØÂä®‰∏éÈ™åËØÅ

### ÁéØÂ¢É‰∏éÁâàÊú¨
ÂëΩ‰ª§Ôºö
uname -a
java -version
gcc --version
cmake --version
ÁªìÊûúÁ≤òË¥¥Ôºö
Darwin Mac.lan 25.0.0 Darwin Kernel Version 25.0.0: Wed Sep 17 21:38:50 PDT 2025; root:xnu-12377.1.9~141/RELEASE_ARM64_T6031 arm64
openjdk version "11.0.26" 2025-01-21
OpenJDK Runtime Environment Homebrew (build 11.0.26+0)
OpenJDK 64-Bit Server VM Homebrew (build 11.0.26+0, mixed mode)
Apple clang version 17.0.0 (clang-1700.3.19.1)
Target: arm64-apple-darwin25.0.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin
cmake version 3.31.3

### Docker ÂêØÂä®‰∏éÈ™åËØÅÔºà‰ΩøÁî® local_env ËÑöÊú¨Ôºâ
ÂëΩ‰ª§Ôºö
./learning_doris/local_env/start-doris.sh
ÁªìÊûúÁ≤òË¥¥Ôºö
Doris cluster started successfully, version: 3.1.1
You can manage the cluster using the following commands:
  Stop cluster: docker-compose -f docker-compose-doris.yaml down
  View logs: docker-compose -f docker-compose-doris.yaml logs -f
  Connect to cluster: mysql -uroot -P9030 -h127.0.0.1
Persistent data directory: ./learning_doris/local_env/doris-data
  FE meta: ./learning_doris/local_env/doris-data/fe/doris-meta -> /opt/apache-doris/fe/doris-meta
  BE storage: ./learning_doris/local_env/doris-data/be/storage -> /opt/apache-doris/be/storage

Access FE/BE http ports (8030, 8040) using the following addresses (Mac system):
  http://docker.for.mac.localhost:8030
  http://docker.for.mac.localhost:8040
Note: If access fails, try using 127.0.0.1 address:
  http://127.0.0.1:8030
  http://127.0.0.1:8040
FE Web UI È™åËØÅÔºöÂ∑≤ÊàêÂäüÊâìÂºÄ `http://127.0.0.1:8030`„ÄÇ

---
--- 
ÂëΩ‰ª§Ôºö
./learning_doris/local_env/manage-doris.sh status
ÁªìÊûúÁ≤òË¥¥Ôºö
üìä Doris cluster status:
WARN[0000] /Users/liuxi/Projects/liuxi/doris/docker-compose-doris.yaml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion 
NAME         IMAGE                   COMMAND                 SERVICE   CREATED              STATUS              PORTS
doris-be-1   apache/doris:be-3.1.1   "bash entry_point.sh"   be        About a minute ago   Up About a minute   0.0.0.0:8040->8040/tcp, :::8040->8040/tcp, 0.0.0.0:9050->9050/tcp, :::9050->9050/tcp
doris-fe-1   apache/doris:fe-3.1.1   "bash init_fe.sh"       fe        About a minute ago   Up About a minute   0.0.0.0:8030->8030/tcp, :::8030->8030/tcp, 0.0.0.0:9010->9010/tcp, :::9010->9010/tcp, 0.0.0.0:9030->9030/tcp, :::9030->9030/tcp

Â§áÊ≥®Ôºö‰∏äËø∞ `version` Ë≠¶Âëä‰∏∫ Docker ÊèêÁ§∫Ôºõcompose Êñá‰ª∂Êú™ËÆæÁΩÆ `version`ÔºåÂèØÂøΩÁï•„ÄÇ

Container details:
---
--- 
ÂëΩ‰ª§Ôºö
./learning_doris/local_env/doris-sql.sh "SHOW FRONTENDS;"
ÁªìÊûúÁ≤òË¥¥Ôºö
---
--- 
ÂëΩ‰ª§Ôºö
./learning_doris/local_env/doris-sql.sh "SHOW BACKENDS\\G"
ÁªìÊûúÁ≤òË¥¥Ôºö
liuxi@Mac:~/Projects/liuxi/doris% ./learning_doris/local_env/doris-sql.sh "SHOW FRONTENDS;"
WARN[0000] /Users/liuxi/Projects/liuxi/doris/docker-compose-doris.yaml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion 
Name    Host    EditLogPort     HttpPort        QueryPort       RpcPort ArrowFlightSqlPort      Role       IsMaster        ClusterId       Join    Alive   ReplayedJournalId       LastStartTime   LastHeartbeat      IsHelper        ErrMsg  Version CurrentConnected
fe_949163cc_5260_4f6d_b655_127b7705a16f 172.20.80.2     9010    8030    9030    9020    -1      FOLLOWER   true    773416400       true    true    293     2025-10-15 06:40:46     2025-10-15 06:42:46true            doris-3.1.1-rc01-fefeaf0dc7a    Yes
---
--- 
ÂëΩ‰ª§Ôºö
./learning_doris/local_env/doris-sql.sh "SHOW BACKENDS\\G"
ÁªìÊûúÁ≤òË¥¥Ôºö
./0-learning_notes/local_env/doris-sql.sh "SHOW BACKENDS\\G"

*************************** 1. row ***************************
              BackendId: 1760404989588
                   Host: 172.20.80.3
          HeartbeatPort: 9050
                 BePort: 9060
               HttpPort: 8040
               BrpcPort: 8060
     ArrowFlightSqlPort: -1
          LastStartTime: 2025-10-15 06:40:45
          LastHeartbeat: 2025-10-15 06:43:46
                  Alive: true
   SystemDecommissioned: false
              TabletNum: 24
       DataUsedCapacity: 0.000 
      TrashUsedCapacity: 0.000 
          AvailCapacity: 137.113 GB
          TotalCapacity: 926.352 GB
                UsedPct: 85.20 %
         MaxDiskUsedPct: 85.20 %
     RemoteUsedCapacity: 0.000 
                    Tag: {"location" : "default"}
                 ErrMsg: 
                Version: doris-3.1.1-rc01-fefeaf0dc7a
                 Status: {"lastSuccessReportTabletsTime":"2025-10-15 06:42:54","lastStreamLoadTime":-1,"isQueryDisabled":false,"isLoadDisabled":false,"isActive":true,"currentFragmentNum":0,"lastFragmentUpdateTime":1760510573129}
HeartbeatFailureCounter: 0
               NodeRole: mix
               CpuCores: 14
                 Memory: 15.66 GB
---
--- 



### ÊúÄÂ∞è SQL ‰∏é EXPLAIN
ÂëΩ‰ª§Ôºö
./learning_doris/local_env/doris-sql.sh -d demo -f /dev/stdin <<'SQL'
CREATE DATABASE IF NOT EXISTS demo;
SELECT DATABASE();
SHOW DATABASES;
CREATE TABLE IF NOT EXISTS t (k1 INT, v1 STRING)
DUPLICATE KEY(k1) DISTRIBUTED BY HASH(k1) BUCKETS 1
PROPERTIES("replication_num"="1");
SHOW TABLES;
SHOW CREATE TABLE t;
INSERT INTO t VALUES (1,'a'),(2,'b');
SELECT * FROM t;
EXPLAIN SELECT * FROM t;
SQL
ÁªìÊûúÁ≤òË¥¥Ôºö

k1      v1
1       a
2       b
Explain String(Nereids Planner)
PLAN FRAGMENT 0
  OUTPUT EXPRS:
    k1[#0]
    v1[#1]
  PARTITION: UNPARTITIONED

  HAS_COLO_PLAN_NODE: false

  VRESULT SINK
     MYSQL_PROTOCAL

  1:VEXCHANGE
     offset: 0
     distribute expr lists: k1[#0]

PLAN FRAGMENT 1

  PARTITION: HASH_PARTITIONED: k1[#0]

  HAS_COLO_PLAN_NODE: false

  STREAM DATA SINK
    EXCHANGE ID: 01
    UNPARTITIONED

  0:VOlapScanNode(54)
     TABLE: demo.t(t), PREAGGREGATION: ON
     partitions=1/1 (t)
     tablets=1/1, tabletList=1760511281955
     cardinality=1, avgRowSize=0.0, numNodes=1
     pushAggOp=NONE



========== STATISTICS ==========



### Ê∏ÖÁêÜ/ÂÅúÊ≠¢
ÂëΩ‰ª§Ôºö
```bash
./learning_doris/local_env/stop-doris.sh
```
ÊàñÔºö
```bash
docker compose -f learning_doris/local_env/docker-compose-doris.yaml down
```